@page "/"
@page "/{catId?}"
@inject HttpClient Http

@if (newss?.Any() != true)
{
    <span>Loading...</span>
}
else
{
    <div class="row content">
        <div class="col-sm-2 sidenav">
            <!-- Khoản trống làm chuyện khác -->
        </div>
        <div class="col-sm-8">
            <!-- Khu vực nội dung bài viết bao gồm tiêu đề -->
            @foreach (var news in newss)
            {
                <div class="position-relative">
                    <h5>@news.Title</h5>
                    <a class="stretched-link" href=@("Post/"+news.Id)></a>
                    <div>
                        @* Kiểm tra image *@
                        @if (news.ImageLink?.Any() != true)
                        {
                            //Nếu ImageLink rỗng hoặc null thì không làm gì
                            //Ngược lại thì thêm ảnh vào vào
                        }
                        else
                        {
                            <img class="img-fluid mx-auto d-block" src=@news.ImageLink.ElementAt(0).TextLink>
                        }
                        <!-- Canh giữa Image: class="mx-auto d-block" -->
                        <!-- img-fluid responsive image -->

                        <p>@news.Content.ElementAt(0).Text</p>
                    </div>
                </div>
            }
        </div>
        <div class="col-sm-2 sidenav">
            <!-- Khoản trống để quảng cáo ^^ -->
        </div>
    </div>
}

@code{
    [Parameter]
    public string catId { get; set; }
    private List<News> newss;

    protected override async Task OnInitializedAsync()
    {
        newss = await Http.GetFromJsonAsync<List<News>>($"news");
        newss = newss.OrderByDescending(x=> x.Id).ToList();
        if (string.IsNullOrEmpty(catId))
        {
            //Không làm gì
        }
        else
        {
            //Chỉnh lại newss
            long catIdLong = long.Parse(catId);
            newss = newss.Where(n => n.Category.Id == catIdLong).ToList();
            StateHasChanged();
        }


    }

    //Khi Parameter thay đổi
    protected override async Task OnParametersSetAsync()
    {
        newss = await Http.GetFromJsonAsync<List<News>>($"news");
            
        //Chỉnh lại newss
        long catIdLong = long.Parse(catId);
        newss = newss.Where(n => n.Category.Id == catIdLong).ToList();
        //Sắp xếp lại
        newss = newss.OrderByDescending(x=> x.Id).ToList();
    }

}